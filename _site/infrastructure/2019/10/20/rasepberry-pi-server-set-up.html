<style>
  table{
    border-left:1px solid #000000;border-top:1px solid #000000;
    width: 100%;
    word-wrap:break-word; word-break:break-all;
  }
  table th{
  text-align:center;
  }
  table th,td{
    border-right:1px solid #000000;border-bottom:1px solid #000000;
  }
</style>

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>zxz0</title>
	<link rel="icon" href="/blog/assets/images/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/blog/assets/js/jquery.min.js"></script>
    <script src="/blog/assets/js/bootstrap.min.js"></script>
    <link href="/blog/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/blog/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <!--[if IE 7]>
    <link rel="stylesheet" href="assets/css/font-awesome-ie7.min.css">
    <![endif]-->
    <!--[if lt IE 9]>
       <script src="https://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
       <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.js"></script>
    <![endif]-->
    <link href="/blog/assets/css/main.css" rel="stylesheet" type="text/css">


</head>

<body>

<div class="container-fluid">
    <div class="row-fluid">
        <div class="navbar navbar-custom navbar-fixed-top" role="navigation">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/blog/">zxz0</a>
            </div>
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    
                    <li class="active"><a href="/blog/">Home</a></li>
                    <li class="active"><a href="/blog/archive.html">Archive</a></li>
                    <li class="active"><a href="/blog/categories.html">Categories</a></li>
                    <li class="active"><a href="/blog/tags.html">Tags</a></li>
                    <li class="active"><a href="/blog/about.html">About</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>


<div class="wrap">
    <div class="container container-left">
        <div class="row">
            <div class="col-md-3 hidden-xs">
                
<div class="sidebar well">
    <header class="sidebar-header" role="banner">
        <a href="/blog/">
            <img src="/blog/assets/images/profile.png" style="width: 150px; height: 150px;" class="img-circle" />
        </a>
        <!--
        <h3 class="title">
        <a href="/"></a>
        </h3>
        -->
    </header>
    <div class="text-center">
        Welcome to zxz0！
    </div>
</div>


<div class="sidebar well">
    <h1>Top Posts</h1>
    <ul>
        
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        
    </ul>
</div>


<div class="sidebar well">
    <h1>Recent Posts</h1>
    <ul>
        
          <li><a href="/blog/framework/2019/11/12/quartz-framework.html">粗观Quartz调度框架</a></li>
        
          <li><a href="/blog/hardware/2019/11/01/welding-related.html">焊接相关准备知识</a></li>
        
          <li><a href="/blog/infrastructure/2019/10/25/family-network-related.html">家庭组网相关知识</a></li>
        
          <li><a href="/blog/infrastructure/2019/10/20/rasepberry-pi-server-set-up.html">树莓派从零开始设置记录</a></li>
        
          <li><a href="/blog/high-performance/2019/10/12/java-thred-safe-visibility-atomicity.html">Java线程安全之可见性和原子性</a></li>
        
    </ul>
</div>

<div class="sidebar well">
    
<h1>Links</h1>
<ul>
  <!-- <li><a href="#">One</a></li>
  <li><a href="#">Two</a></li>
  <li><a href="#">Three</a></li>
  <li><a href="#">Four</a></li> -->
  
  <li>
    <a href="http://xixia.info">
      Xixia
    </a>
  </li> 
  
  <li>
    <a href="https://github.com/zxixia/jekyll-xixia">
      Jekyll-Xixia
    </a>
  </li> 
  
</ul>

</div>

            </div>
            <div class="col-md-9">
                
<div class="well article">
        <h2><a href="/blog/infrastructure/2019/10/20/rasepberry-pi-server-set-up.html">树莓派从零开始设置记录</a></h2>
        <span class="post-date">
            
            10/20/2019
        </span>
        <hr style="border-top:1px solid #28323C;"/>
    
    <div class="post-content">
    <h3 id="已有知识">已有知识：</h3>
<ul>
  <li>学过中学物理（电流电路……）</li>
  <li>玩过51单片机（只会用C点亮LED灯）</li>
  <li>会C，Python和Bash</li>
  <li>了解了一点SSH</li>
</ul>

<h3 id="过程">过程：</h3>
<p>在查资料的过程中，大概理解了，树莓派就是一个性能尚可的带了很多接口的ARM构架的微型主机。server，只是一个能发挥其部分作用的应用方向。好像更多的是当作智能硬件来用？</p>

<p>那么首先，需要操作系统：</p>
<ul>
  <li>在<a href="https://www.raspberrypi.org/">官网</a>下载基于Debian的Linux操作系统<a href="https://www.raspberrypi.org/downloads/raspbian/">Raspbian</a>
    <ul>
      <li>尝试下载zip，但是速度太慢 -&gt; 试着下载种子 -&gt; 发现没有种子下载器 -&gt; do research，Mac上多人推荐Folx -&gt; 下载Folx本身速度很慢 -&gt; 算了，直接从官网下载最精简版Raspbian Buster Lite的zip。</li>
      <li>检查checksum，官网给出的是SHA-256:a50237c2f718bd8d806b96df5b9d2174ce8b789eda1f03434ed2213bbca6c6ff，在终端运行指令:
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">download</span><span class="o">=</span><span class="k">$(</span>shasum <span class="nt">-a</span> 256 2019-09-26-raspbian-buster-lite.zip<span class="k">)</span>
<span class="o">[</span> <span class="k">${</span><span class="nv">download</span><span class="p">%% *</span><span class="k">}</span> <span class="o">=</span> <span class="s2">"a50237c2f718bd8d806b96df5b9d2174ce8b789eda1f03434ed2213bbca6c6ff"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo </span>1 <span class="o">||</span> <span class="nb">echo </span>0 	<span class="c"># %% return content of the variable with the longest occurrence of substring deleted from the back of the variable. ' *' matched ' 0orMoreChars'</span>
</code></pre></div>        </div>
        <p>确定符合。</p>
      </li>
    </ul>
  </li>
  <li>烧录系统：
    <ul>
      <li>下载<a href="https://www.balena.io/etcher/">balenaEtcher</a>（Windows上好像是用Win32DiskImager比较多）</li>
      <li>解压zip文件，得到img镜像</li>
      <li>micro SD卡转接插入电脑，选择，烧录
        <ul>
          <li>最后烧录成2个分区，FAT32的root分区（内核），以及EXT4分区（操作系统）（Window上会显示磁盘没有格式化：系统不认识；Mac压根不会显示）</li>
        </ul>
      </li>
    </ul>

    <p>此处，发现其实SD卡内本来烧录好了full的系统，但是我直接写了，并没有先格式化，不知道会对后续有何影响</p>
  </li>
  <li>检查系统烧录情况：
    <ul>
      <li>用micro HDMI连上支持HDMI口的显示屏</li>
      <li>连接电源，树莓派自动开机（暂时不连其他外设，以免开机失败）</li>
    </ul>
  </li>
</ul>

<p>确认系统正常工作</p>

<p>至此，树莓派就变成了一台Linux主机。</p>

<p>因为还买了外壳，所以接下来装外壳：</p>
<ul>
  <li>壳组转本身按照模糊的视频教程，以及商品照片来就可以，参考每个板的凸凹，以及合适程度确认</li>
  <li>附带了散热片
    <ul>
      <li>按照大小，分别装在CPU（风扇下方，方形的），内存芯片（中间，最长的），USB管理芯片（靠USB口，方的）上</li>
    </ul>
  </li>
  <li>附带了一个风扇，带红白线，到一个头上
    <ul>
      <li>风扇电源红线（接正极）那边接在离板中心近的5v power的GRIO口上（GRIO口横排在上，上排的左边数起第2个口。物理引脚BOARD编码：4），黑线那边（接负极）自然地卡在旁边的地线GND（GRIO口横排在上，上排的左边数起第3个口。物理引脚BOARD编码：6）上，形成5V电压（电势差）</li>
      <li>风扇有logo的那边朝外，因为想从CPU抽热气（给的风扇logo面是凹，凸进凹出。可以想象凹的那面“舀”空气，把空气往外送/让空气变稀薄从而高压吹低压）（过后可以统计温度数据，最终决定装入风还是出风）</li>
    </ul>
  </li>
</ul>

<p>进行server所需的设置：</p>
<ul>
  <li>SSH设置：（自2016年9月开始，raspberry默认关闭ssh连接）
    <ul>
      <li>在micro SD卡的boot分区里新建一个名为“ssh”的空白文件</li>
      <li>或者，在机器上执行命令<code class="highlighter-rouge">sudo raspi-config</code>后，选择5 Interfacing Options - P2 SSH</li>
      <li>再或者，直接在机器上</li>
      <li>验证可以正常登陆：
        <ol>
          <li>用树莓派连上路由器的一个LAN口，电脑连同一个路由器的另一个LAN口，保证在同一子网下。</li>
          <li>从路由器设置页面得知树莓派ip，或者树莓派接上显示屏，<code class="highlighter-rouge">ifconfig</code>，结合<code class="highlighter-rouge">networksetup -listallhardwareports</code>确定ip（eth0代表有线网络，wlan0代表无线网络）</li>
          <li>ssh pi@raspberry_pi_ip_address 看是否成功（密码：raspberry）</li>
        </ol>
      </li>
    </ul>
  </li>
  <li>或者可以使用telnet，xrdp，VNC等方式</li>
  <li>Windows可能没有预装SSH，可以用PuTTY(注意，默认设置是禁用小键盘，在Terminal - Features中修改)或者安装OpenSSH进行连接</li>
</ul>

<p>ok，已经验证可以SSH登陆了（<code class="highlighter-rouge">ssh username@ip</code>），接下来就是要真正接入网络了，为了顺便复习一下计算机网络，单独写在下一篇文章内。</p>

<p>验证完过后，进行一些SSH有关的安全设置：</p>
<ul>
  <li>添加SSH key（可以参照上一篇文章:<a href="/blog/practice/2019/09/10/Gitlab-SSH-key.html">GitLab设置SSH key，以及相关知识</a>）<!-- notice the link might change! --></li>
  <li>可以改SSH的端口（默认22）</li>
</ul>

<p>一些基本设置：</p>
<ul>
  <li>修改默认的密码：
    <ul>
      <li>root登陆，输入passwd，就可以修改</li>
      <li>修改别的用户的，passwd xx（用户名），按照提示即可修改</li>
    </ul>
  </li>
  <li>安装vim：自带的vi很不方便（插入模式）
    <ul>
      <li><code class="highlighter-rouge">sudo apt-get install vim</code></li>
    </ul>
  </li>
</ul>

<p>固定ip的话，可以直连树莓派端进行设置(/etc/dhcpcd.conf文件中)，也可以在路由器处设置然后连接树莓派。此处，在路由器设置界面把Mac和ip绑定了，做了端口转发。</p>

<p>使用Django快速建立项目进行测试：</p>
<ul>
  <li>Raspberry自带Python2.7和Python3.4</li>
  <li><code class="highlighter-rouge">find / -name pip*</code> 尝试查找pip，发现没有</li>
  <li>安装pip：尝试：
    <ul>
      <li><code class="highlighter-rouge">sh
  curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
  python get-pip.py
 </code> 但是无法安装pip3</li>
      <li><code class="highlighter-rouge">sudo apt-get install python3-pip</code> 成功安装pip3</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">pip install Django</code></li>
  <li>为了让django-admin可以使用，还要加入环境变量：<code class="highlighter-rouge">export PATH=$PATH:/home/pi/.local/bin</code>。这是暂时的，当下生效；还需要在系统开机文件中添加这个语句，才能保证之后每次开机之后PATH变量都带这个directory：<code class="highlighter-rouge">test</code></li>
  <li><code class="highlighter-rouge">django-admin startproject mysite</code> 创建项目</li>
  <li><code class="highlighter-rouge">python manage.py runserver</code> 运行项目，默认端口8000</li>
  <li>尝试从同一子网的机器直接access，发现不行，虽然ping和ssh都可以，猜测原因：服务器禁止访问
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim hello_world/settings.py
ALLOWED_HOSTS <span class="o">=</span> <span class="o">[</span><span class="s1">'192.168.1.10'</span><span class="o">]</span> 	<span class="c"># add this</span>
</code></pre></div>    </div>
  </li>
  <li>还是不可以，猜测是主机防火墙（iptables）设置问题？使用ufw开启端口，注意也要开启22的ssh端口（未验证）</li>
</ul>

<p>一些问题：</p>
<ul>
  <li>速度有点慢？
    <ul>
      <li>做research的时候，知道了是千兆网口，但是I/O比较弱，跟不上，因为是micro SD卡读写。SSD会快。</li>
      <li>内存/硬盘不够？所以买大内存，大micro SD卡（32G以上好像需要reformat以及分区）</li>
      <li>选择读写速度快，稳定的micro SD卡（最低class2，2MB/s；最高3，30MB/s。作为参考，SSD速度，是三位数……最高可以以G为单位）</li>
      <li>换了4G内存，32G SD卡，依旧比较慢</li>
      <li>继续research，比较其他server，发现延迟差不多，但是就是测速很慢</li>
      <li>是在某个节点，推测线路是瓶颈？</li>
      <li>ipip.net，工具TraceRoute或者tracet 查看路由以及延迟</li>
      <li>ping.pe或者mtr查看各站丢包情况</li>
      <li>国内网络情况复杂，不同的运营商之间慢，因为超售，国际慢（比如电信必须专用CN2线路才快，所以要找到的好的线路/机房）</li>
      <li>BBR加速（谷歌的拥塞控制算法。Linux的4.9版内核已经使用该算法）</li>
    </ul>
  </li>
</ul>

<p>Linux上的一些命令的复习：</p>
<ul>
  <li>grep (Global Regular Expression Print)：管道正则搜索。 <code class="highlighter-rouge">grep 'test' d*</code></li>
  <li>wget：下载</li>
  <li>scp：拷贝。eg. <code class="highlighter-rouge">scp work@192.168.0.10:/home/work/source.txt work@192.168.0.11:/home/work/ 	#把192.168.0.10机器上的source.txt文件拷贝到192.168.0.11机器的/home/work目录下</code></li>
</ul>

<hr />
<h4 id="参考资料">参考资料：</h4>
<ul>
  <li><a href="https://blog.csdn.net/huayucong/article/details/48107267">树莓派的操作系统介绍</a></li>
  <li><a href="https://blog.csdn.net/hongweigg/article/details/77948664">Linux shell 命令多行结果赋值给变量</a></li>
  <li><a href="https://www.cnblogs.com/fetty/p/4857158.html">Linux字符串截取命令</a></li>
  <li><a href="https://www.howtogeek.com/270333/what-does-the-percent-sign-in-linux-shell-strings-do/">What Does the Percent Sign in Linux Shell Strings Do?</a></li>
  <li><a href="https://blog.csdn.net/shuai0845/article/details/86532142">linux下的字符串比较</a></li>
  <li><a href="http://www.jjlog.com/fenxiang/207.html">如何识别HDMI、[mini]HDMI、[micro]HDMI接口</a></li>
  <li><a href="http://www.raspigeek.com/index.php?c=read&amp;id=126&amp;page=1">树莓派散热片安装与风扇接线方法/ 和自动温控方法</a></li>
  <li><a href="https://www.basemu.com/raspberry-pi-4-gpio-pinout.html">树莓派4的GPIO接口介绍</a></li>
  <li><a href="https://blog.csdn.net/coolwriter/article/details/75577092">树莓派GPIO入门</a></li>
  <li><a href="https://www.cnblogs.com/vamei/p/6751992.html">树莓派的GPIO编程</a></li>
  <li><a href="https://product.pconline.com.cn/itbk/diy/power/1707/9645570.html">机箱风扇方向 机箱风扇怎么安装最靠谱？</a></li>
  <li><a href="https://zhuanlan.zhihu.com/p/63818978">谈一谈CPU散热与机箱风扇</a></li>
  <li><a href="https://zhuanlan.zhihu.com/p/53743408">三秒钟区分电脑风扇进风端和出风端</a></li>
  <li><a href="https://blog.csdn.net/kxwinxp/article/details/78370913">树莓派3B+ 安装系统</a></li>
  <li><a href="http://shumeipai.nxez.com/2017/09/13/raspberry-pi-network-configuration-before-boot.html">无屏幕和键盘配置树莓派WiFi和SSH</a></li>
  <li><a href="http://shumeipai.nxez.com/2017/02/27/raspbian-ssh-connection-refused.html">树莓派新系统SSH连接被拒绝的解决方法</a></li>
  <li><a href="https://blog.csdn.net/huayucong/article/details/52966502">使用Raspi-config配置工具来设置树莓派</a></li>
  <li><a href="https://blog.csdn.net/zdwzzu2006/article/details/6928803">linux查看本机IP、gateway、dns</a></li>
  <li><a href="https://blog.csdn.net/m0_37556444/article/details/83351952">mac的ifconfig命令</a></li>
  <li><a href="https://blog.csdn.net/naibozhuan3744/article/details/84963024">树莓派查看ip地址（命令ifconfig）和退出ping</a></li>
  <li><a href="https://blog.csdn.net/wuli_dear_wang/article/details/84446168">树莓派远程连接的四种方式（最全）</a></li>
  <li><a href="https://blog.csdn.net/u011630575/article/details/49821281">修改linux用户密码（passwd）</a></li>
  <li><a href="https://stackoverflow.com/questions/6587507/how-to-install-pip-with-python-3">How to install pip with Python 3?</a></li>
  <li><a href="https://opensource.com/article/17/6/set-path-linux">How to set your $PATH variable in Linux</a></li>
  <li><a href="https://blog.csdn.net/Calvin_zhuyue/article/details/67677491">树莓派搭建django</a></li>
  <li><a href="https://wsgzao.github.io/post/iptables/">iptables 配置实践</a></li>
  <li><a href="https://www.cnblogs.com/haochuang/p/6214534.html">【树莓派】配置树莓派防火墙</a></li>
  <li><a href="https://docs.djangoproject.com/en/2.2/intro/tutorial01/">Writing your first Django app</a></li>
  <li><a href="https://gist.github.com/nex3/c395b2f8fd4b02068be37c961301caa7">path.md</a></li>
  <li><a href="https://www.cnblogs.com/end/archive/2012/02/21/2360965.html">linux grep命令</a></li>
  <li><a href="https://blog.csdn.net/qq_31010431/article/details/54285664">SSH远程拷贝文件</a></li>
  <li><a href="https://www.jianshu.com/p/59df0009316e">树莓派3b+从0开始：（2）SD卡的配置</a></li>
  <li><a href="https://blog.csdn.net/QianZhaoVic/article/details/79031359">从Linux服务器下载文件夹到本地</a></li>
  <li><a href="https://blog.csdn.net/u013178472/article/details/78574878">树莓派手动指定静态IP和DNS 终极解决大法</a></li>
  <li><a href="https://tech.itabas.com/2016/09/08/raspberry/access-raspberry/">外网访问树莓派</a></li>
  <li><a href="https://blog.csdn.net/lqxandroid2012/article/details/79696318">用ping ，mtr ，traceroute 进行网络丢包分析</a></li>
  <li><a href="https://zhuanlan.zhihu.com/p/28580807">Micro SD 卡你真的会选么？</a></li>
  <li><a href="https://blog.csdn.net/xxNull/article/details/78280581">树莓派之SSH连接经验</a></li>
  <li><a href="http://wiki.jikexueyuan.com/project/raspberry-pi/software.html">树莓派常用软件及服务</a></li>
  <li><a href="http://einverne.github.io/post/2017/11/mtr-usage.html">每天学习一个命令: mtr 查看路由网络连通性</a></li>
  <li><a href="https://blog.csdn.net/lynxzong/article/details/89810538">树莓派如何开启谷歌的BBR TCP加速</a></li>
  <li><a href="https://www.liuboping.com/%E5%BC%80%E5%90%AFtcp-bbr%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E7%AE%97%E6%B3%95/">开启TCP BBR拥塞控制算法</a></li>
  <li><a href="https://fangeqiang.com/1378.html">[科普] 为什么你用的VPN网速那么慢？</a></li>
  <li><a href="https://blog.csdn.net/farYang/article/details/50788795">树莓派安装mysql并开启远程访问(开启3306端口)</a></li>
  <li><a href="https://blog.csdn.net/lamp_yang_3533/article/details/52154695">同一局域网内的其他电脑访问我的电脑本地的网站</a></li>
</ul>

    <hr style="border-top:1px solid #28323C;"/>

    <!-- tags and categories under post -->
    
    <ul class="list-unstyled list-inline">
      <li><i class="icon-folder-open"></i></li>
      
      
         
            <li class="icon-style"><a href="/blog/categories.html">
                Infrastructure <span>(2)</span>
                
            </a></li>
        
      
    </ul>
      

    
    <ul class="list-unstyled list-inline">
      <li><i class="icon-tags"></i></li>
      
      
         
            <li class="icon-style">
                <a href="/blog/tags.html">
                ARM <span>(1)</span>
                ,
                </a>
            </li>
         
            <li class="icon-style">
                <a href="/blog/tags.html">
                Computer <span>(1)</span>
                ,
                </a>
            </li>
         
            <li class="icon-style">
                <a href="/blog/tags.html">
                DevOps <span>(1)</span>
                
                </a>
            </li>
        
      
      
    </ul>
      

    </div>
    
</div>
<div class="pagination">
    
    <a class="btn btn-default" href="/blog/infrastructure/2019/10/25/family-network-related.html" class="next">Newer Post</a>
    
    
    <a class="btn btn-default" href="/blog/high-performance/2019/10/12/java-thred-safe-visibility-atomicity.html" class="previous">Older Post</a>
    
</div>
            </div>
        </div>
    </div>

    
<div class="footer">
    <p>&copy;2019 zxz0 , Powered by
            
                <a href="http://jekyllrb.com/">
                Jekyll
                </a>
                <!-- not the last, output a ',' -->
                
                ,
                
            
                <a href="http://getbootstrap.com/">
                Bootstrap
                </a>
                <!-- not the last, output a ',' -->
                
                ,
                
            
                <a href="https://github.com/">
                Github
                </a>
                <!-- not the last, output a ',' -->
                
                ,
                
            
                <a href="https://github.com/zxixia/jekyll-xixia">
                Xixia
                </a>
                <!-- not the last, output a ',' -->
                
            
    </p>
</div>

<!-- 
    

    
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', '', 'auto');
    ga('send', 'pageview');
  </script>

 
-->

</body>
</html>

</div>